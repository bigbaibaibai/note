# 一、计算机基础

## 1.网络调优

查看个连接状态的计数情况（主要关注time_wait和close_wait）

`netstat -n | awk '/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}'`

![1569557642922](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1569557642922.png)

close_wait一般是资源未释放导致的，是代码问题

time_wait需要调整参数

文件/etc/sysctl.conf中包含了网络相关的参数，如需修改，需要执行/sbin/sysctl -p指令使修改后的参数生效

调整time_wait的参数：

`net.ipv4.tcp_fin_timeout = 30`（建议小于30秒）

在RFC793规定MSL为2分钟。但是在当前的高速网络中，2分钟的等待时间会造成资源的极大浪费，在高并发服务器上通常会使用更小的值。

查看HTTPS的连接状态，此处是close_wait

`netstat -ant|grep -i "443" | grep CLOSE_WAIT | wc -I`



## 2.数据库优化

**数据库连接池调优注意事项** 

1）如果MIN过小，可能会出现过多请求排队等待获取连接，如果MIN过大，会造成资源浪费。如果MAX小，则峰值2.情况下仍有很多请求处于等待状态；

3）如果MAX过大，可能导致数据库连接被占满，大量请求超时，进而影响其他应用，引发服务器连环雪崩。

4）在实际业务中，假如数据库配置的MAX是100，一个请求10ms ,则最大能够处理10000QPS。增大连接数，有可能会超过单台服务器的正常负载能力。

5）另外，连接数的创建是受到服务器操作系统的fd（文件描述符）数量限制的。创建更的活跃连接，就需要消耗更多的fd，系统默认单个进程可同时拥有1 0 2 4个fd，该虽然可以适当调整，但如果无限制地增加，会导致服务器在fd的维护和切换上消耗过多的精力，从而降低应用吞吐量。

**数据库请求优化**

在数据库层面的请求应答时间必须在100ms以内，秒级的SQL查询通常存在巨大的性能提升空间，有如下应对方案，

（1）建主高效且合适的索引。索引谁都可以建，但要想建好难度极大。因为索引既有数据特征，又有业务特征，数据量的变化会影响索引的选择，业务特点不样，索引的优化思路也不样。通常某个字段平时不用，但是某种触发场景下命中“索引缺失”的字段会导致查询瞬间变慢。所以，要事先明确业务场景，建立合适的索引。

（2）排查连接资源未显式关闭的情形。要特别注意在ThreadLocal或流式计算申使用数据库连接的地方。

（3）合并短的请求。根据CPU的空间局部性原理，对于相近的数据，CPU会起提取到内存中。另外，合并请求也可以有效减少连接的次数。

（4）合理拆分多个表join的SQL，若是超过三个表则禁止join。如果表结构建得不合理，应用逻辑处理不当，业务模型抽象有问题，那么三表j o i n的数据量由于笛卡儿积操作会呈几何级数增加，所以不推荐这样的做法。另外，对于需要join的字段，数据类型应保持绝对一致。多表关联查询时，应确保被关联的字段要有索引。

（5）使用临时表。某种情况下，该方法是一种比较好的选择。曾经遇到－个场景不使用临时表需要执行1个多小时，使用临时表可以降低至2分钟以内。因为在不断的嵌套查询中，已经无法很好地利用现有的索引提升查询效率，所以把中间结果保存到临时表1然后重建索引，再通过临时表进行后续的数据操作。

（6）应用层优化。包括进行数据结构优化、并发多线程改造等。

（7）改用其他数据库。因为不同数据库针对的业务场景是不同的，比如Cassandra、MongoDB。

## 3.网络攻击

### 1、XSS：跨站脚本攻击

**简介**：XSS是指黑客通过技术手段，向正常用户请求的HTML页面中插入恶意脚本，从而可以执行任意脚本。xss主要分为反射型xss、存储型xss和DOM型xss。xss主要用于信息窃取、破坏等目的

**主要手法**：向HTML页面中插入恶意脚本

比如发一条微博，微博中含有JavaScript代码，每个加载此微博的用户都会执行这个JavaScript代码

**防范措施**：主要通过对用户输入数据做过滤或者转义。比如Java开发人员可以使用Jsoup框架对用户输入字符串做xss过滤，或者使用框架提供的工具类对用户输入的字符串做HTML转义，例如Spring框架提供的HtmlUtils。前端在浏览器展示数据时，也需要使用安全的API展示数据，比如使用innerText而不是innerHTML。所以需要前、后端开发人员一同配合才能有效防范xss漏洞。

### 2、CSRF：跨站请求伪造

**简介**：跨站请求伪造（Cross-Site Requ est Forgery），简称CSRF，也被称为One-clickAttack，即在用户并不知惰的情况下，冒充用户发起请求，在当前已经登录的Web应用程序上执行恶意操作，如恶意发帖、修改密码、发邮件等。

**主要手法**：API调用

比如某用户A登录了网上银行，黑客给他发一个url

`https://net-bank.demo/transfer.do?targetAccount=l2345&amount=l00`

A用户在打开了网银的浏览器中点开了黑客的url，就有可能在用户A不知情的情况下从他的账户转账100元到其他账户。

**防范措施**：

（1）CSRFToken验证，利用浏览器的同源限制，在HTTP接口执行前验证页面或者Cookie中设置的Token，只有验证通过才继续执行请求。

（2）人机交互，比如在调用上述网上银行转账接口时校验短信验证码。

## 4.HTTPS请求

HTTPS公私钥加密是为了只有双方才可以解密信息，主要用于建立连接时，对握手信息的加密

连接创建后使用随机数生成的对称秘钥加密解密

CA签名是为了确认服务端的真实性，防止服务端伪造

HTTPS的流程：

![1569581339489](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1569581339489.png)

